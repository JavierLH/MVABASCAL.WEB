@* NavMenu.razor *@
<div class="top-row ps-3 navbar navbar-dark d-flex align-items-center justify-content-between">
    <div class="container-fluid p-0 d-flex align-items-center">
        <a class="navbar-brand me-auto" href="">ABASCAL</a>

        <button class="btn btn-link text-white p-0 me-3" @onclick="ToggleSidebar">
            <span class="bi bi-list fs-3 toggler-icon"></span>
        </button>
    </div>
</div>

<div class="@NavMenuCssClass nav-scrollable" @onclick="ToggleNavMenu">
    <nav class="flex-column">
        <AuthorizeView>
            <Authorized>
                <div class="nav-item px-3">
                    <NavLink class="nav-link" href="" Match="NavLinkMatch.All">
                        <span class="bi bi-house-door-fill-nav-menu" aria-hidden="true"></span>
                        <span class="nav-text">Inicio</span>
                    </NavLink>
                </div>

                <div class="nav-item px-3">
                    <NavLink class="nav-link" href="clientes">
                        <span class="bi bi-people-fill-nav-menu" aria-hidden="true"></span>
                        <span class="nav-text">Clientes</span>
                    </NavLink>
                </div>

                <div class="nav-item px-3">
                    <div class="nav-link d-flex align-items-center" @onclick="ToggleManifestaciones">
                        <span class="bi bi-folder2-open-nav-menu" aria-hidden="true"></span>
                        <span class="nav-text flex-grow-1">Manifestaciones</span>
                        <span class="bi @(expandManifestaciones ? "bi-chevron-down" : "bi-chevron-right") small ms-auto"></span>
                    </div>
                </div>

                @if (expandManifestaciones)
                {
                    <div class="nav-item px-3 ps-5 animate__animated animate__fadeInLeft animate__faster">
                        <NavLink class="nav-link" href="manifestaciones">
                            <span class="bi bi-list-ul-nav-menu" aria-hidden="true"></span>
                            <span class="nav-text">Ver Listado</span>
                        </NavLink>
                    </div>
                    <div class="nav-item px-3 ps-5 animate__animated animate__fadeInLeft animate__faster">
                        <NavLink class="nav-link" href="manifestaciones/nueva">
                            <span class="bi bi-plus-square-nav-menu" aria-hidden="true"></span>
                            <span class="nav-text">Crear Nueva</span>
                        </NavLink>
                    </div>
                }
            </Authorized>
        </AuthorizeView>
    </nav>
</div>

@code {
    private bool collapseNavMenu = true;
    private bool expandManifestaciones = false;

    [Parameter] public bool MenuColapsado { get; set; } // Recibir estado del padre
    [Parameter] public EventCallback ToggleSidebar { get; set; }

    private string? NavMenuCssClass => collapseNavMenu ? "collapse" : null;

    private void ToggleNavMenu()
    {
        collapseNavMenu = !collapseNavMenu;
    }

    private async Task ToggleManifestaciones()
    {
        // MEJORA: Si el menú está cerrado y queremos abrir el submenú,
        // forzamos la apertura del sidebar para que el usuario vea qué está abriendo.
        if (MenuColapsado)
        {
            await ToggleSidebar.InvokeAsync();
        }

        expandManifestaciones = !expandManifestaciones;
    }
}